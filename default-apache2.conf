#[Crear clave]
#[Dar permisos]
# [Crear usuarios]
#[Asigna grupos a una carpeta]
# [Shellinabox]
# [Cron]
# [Cambiar zona horaria]
# [LAMP/phpinfo]
# [RAID]
# [EspacioDisco]
# [Cuotas]
# [LVM]
# [ScriptCopias]
# [Mikrotik (reenvío de Ips)]
# [UPDATE]
# [MTU]
# [DNS]
# [IP ADDRESS]
# [IP ROUTE]
# [ARP]
# [SRCNAT]
# [RUTAS Gcloud]
# [DSTNAT]
# [Analizar TCP/UDP]
# [Balanceador]
# [Prueba]

##Crear clave
#ssh-keygen -t rsa -b 4096 -f ubuntu-brr746.pem -C "ubuntu"
#
#Copiar clave publica en /.ssh/authorized_keys
#sudo nano /.ssh/authorized_keys
#
##Dar permisos 
#sudo chown ubuntu:ubuntu /home/ubuntu/.ssh
#sudo chmod 700 /home/ubuntu/.ssh
#sudo chmod 600 /home/ubuntu/.ssh/authorized_keys
#
#Para contraseña cambiar:
#
#sudo nano /etc/ssh/sshd_config 
#sudo nano /etc/ssh/sshd_config.d/*.conf

##Crear usuarios:
#sudo useradd -m profesor-A 

#Crear grupo
##sudo groupadd profesores 

#Ponerles contraseña:
#sudo passwd profesor-A

##Asigna grupos a una carpeta 
#sudo chgrp estudiantes /opt/publico
#chmod g+s /opt/publico (y todos los archivos de dentro)
#sudo chmod  770 /ruta a la carpeta 
#(root,grupos,otros) RWX=7 RW=3 RX=5 WX=6

#Añadir usuario a grupos:
#sudo adduser profesor-A profesores (sudo adduser “nombredelusuario” “nombredelgrupo”)
#
#Crear directorios por defecto
#sudo mkdir /etc/skel/"directorio que quieras"


#Dar permisos de admin a grupos
#sudo visudo 
#%grupo ALL=(ALL:ALL) ALL

#Mover archivos
#scp /ruta/archivo/local ubuntu@IP_PUBLICA /ruta/archivo/mv

##Shellinabox
#sudo apt install shellinabox -y
#sudo nano /etc/defaults/shellinabox (--disable-ssl)
#sudo systemctl stop/start/restart shellinabox 
#
#
##Cron
#sudo apt update 
#sudo apt install cron -y 
#sudo systemctl enable cron
#sudo systemctl start cron
#Para programar un script:
#sudo crontab -e 
#* * * * * ruta/del/archivo.sh (minuto hora dia_mes mes dia_semana)
#
#/sbin/shutdown -h now
#
#
##Cambiar zona horaria
#timedatectl 
#sudo timedatectl set-timezone Europe/Madrid
#(schedule)
#
 
##LAMP/phpinfo
# 
#Apache
#sudo apt install apache2 -y
#Mysql
#wget https://dev.mysql.com/get/mysql-apt-config_0.8.29-1_all.deb
#sudo dpkg -i mysql-apt-config_0.8.29-1_all.deb 
#sudo apt install mysql-server -y
#sudo mysql_secure_installation
#Php
#sudo apt install php libapache2-mod-php php-mysql -y 
#sudo nano phpinfo.php

#<?php
#phpinfo();
#?>


##RAID 
#raid5=3discos
#raid10=4discos
#
#sudo fdisk /dev/sdb
#sudo mdadm --create /dev/md0 --level=10 --raid-devices=4 /dev/sdb1 /dev/sdb2 /dev/sdb3 /dev/sdb4
#cat /proc/mdstat
#watch -n 1 cat /proc/mdstat
# sudo mkfs -t ext4 /dev/md0
# UUID=ae8e5116-3394-4a8d-a3df-6a550d4cd13d /var/www/html ext4 defaults,nofail 0 2
#sudo mount -a
#
 
##EspacioDisco
#df -h 
#
##Cuotas
#sudo apt update
#sudo apt install -y linux-modules-extra-$(uname -r)
#sudo apt install quota quotatool - y 
#
#sudo nano /etc/fstab  
#En / -> discard,errors=remount-ro,usrquota,grpquota
#sudo mount -o remount / 
#sudo quotaoff -vg /
#sudo quotacheck -cugm /
#sudo quotaon -vg / 
#sudo setquota -g estudiantes 460800 512000 0 0 /
#sudo repquota -gv /
#
#

#
#
##LVM
#sudo fdisk /dev/sdb
#g 
#n  
#1 
#Enter
#Tamaño que quieras
#t 
#31
#w
#sudo partprobe /dev/sdb
#
#sudo pvcreate /dev/sdb1
#sudo vgcreate vg_login /dev/sdb1
#sudo lvcreate -l 100%FREE -n lv_datos vg_login
#
#sudo mkfs -t ext4 -F -L vol_cs2 /dev/vg_login/lv_datos
#sudo mkdir -p /mnt/vol_cs2
#sudo mount -L vol_cs2 /mnt/vol_cs2
#
#echo "LABEL=vol_cs2 /mnt/vol_cs2 ext4 defaults,nofail 0 2" | sudo tee -a /etc/fstab
#
##LINUX:
#sudo fdisk /dev/sdb
#n 
#p
#1
#Enter
#Tamaño (+5G)
#w
#sudo partprobe /dev/sdb
#
#sudo mkfs -t ext4 -L vol_linux /dev/sdb2
#sudo mkdir -p /mnt/vol_linux
#sudo mount -L vol_linux /mnt/vol_linux
#sudo nano /etc/fstab
#LABEL=vol_linux /mnt/vol_linux ext4 defaults,nofail 0 2
#
##ScriptCopias
#    
#    sudo apt install cron -y 
#    sudo crontab -e (elegir 1)
#* * * * * /ruta/archivo/script.sh >> /var/log/copia_backup.log 2>&1 
#
#sudo cat /var/log/copia_backup.log 
#(Y así ver posibles errores)
#    
#sudo chmod +x script.sh
#
#SCRIPT COPIAS SEGURIDAD
#    #!/bin/bash
#
# # === CONFIGURACIÓN ===
#LOGIN="brr746"      # <-- Sustituir por tu identificador
#ORIGEN="/home"
#DESTINOS=("/mnt/vol_cs1" "/mnt/vol_cs2")
#FECHA=$(date +"%d_%m_%Y_%H_%M")
#NOMBRE="copia-$LOGIN-$FECHA.tar.gz"
#RUTA_TMP="/tmp/$NOMBRE"
#MIN_LIBRE_MB=200     # Espacio mínimo que debe quedar libre en cada volumen
#
# # === CREAR LA COPIA DE SEGURIDAD ===
#echo "[INFO] Generando copia de seguridad..."
#tar -czf "$RUTA_TMP" "$ORIGEN"
#
# # === PROCESAR CADA VOLUMEN ===
#for DESTINO in "${DESTINOS[@]}"; do
#
#    echo "[INFO] Procesando volumen: $DESTINO"
#
#    # Crear directorio si no existe
#    mkdir -p "$DESTINO"
#
#    # Comprobar espacio libre en MB
#    LIBRE=$(df -m "$DESTINO" | awk 'NR==2 {print $4}')
#
#    echo "[INFO] Espacio libre antes: ${LIBRE}MB"
#
#    # Mientras no haya espacio suficiente, borrar la copia más antigua
#    while [ "$LIBRE" -lt "$MIN_LIBRE_MB" ]; do
#        MAS_ANTIGUA=$(ls -1t "$DESTINO" | grep "copia-$LOGIN" | tail -n 1)
#
#        if [ -z "$MAS_ANTIGUA" ]; then
#            echo "[WARN] No quedan copias antiguas para borrar."
#            break
#        fi
#
#        echo "[INFO] Borrando copia antigua: $MAS_ANTIGUA"
#        rm -f "$DESTINO/$MAS_ANTIGUA"
#
#        # Recalcular espacio
#        LIBRE=$(df -m "$DESTINO" | awk 'NR==2 {print $4}')
#        echo "[INFO] Espacio libre ahora: ${LIBRE}MB"
#    done
#
#    # Copiar nueva copia de seguridad
#    echo "[INFO] Copiando nueva copia a $DESTINO ..."
#    cp "$RUTA_TMP" "$DESTINO"
#
#done
#
## Eliminar copia temporal
#rm -f "$RUTA_TMP"
#
#echo "[INFO] Copia completada correctamente."
#
#
#    
#    
#
##Mikrotik (reenvío de Ips) 
#mv nombre.img disk.raw
#tar -Sczf nombre.img.tar.gz disk.raw
#Crear bucket> subir archivo > nombre.img.tar.gz
#Crear imagen-mikrotik > archivoGCP >Explorar > Bucket > nombre.tar.gz
#
##UPDATE
#/system package update check-for-updates
#/system package update install 
#
##MTU
#/interface set ethernet1 mtu=VALOR 

##DNS
#/ip dns set servers=8.8.8.8,8.8.4.4
#/ip dns set allow-remote-requests=yes


##IP ADDRESS
#
#/ip address add address=direccion_Interna(mikrotik)/32 network=gateway(0.1) interface=interfaz_correspondiente
#
##IP ROUTE
#/ip route add dst-address=dir_red(.0.0)/24 gateway=dir_red.(0.1)

##ARP
#/interface ethernet set ether1 arp=enabled
#
##SRCNAT -> Cambia la ip de mvs sin internet a ip publicas para que puedan salir 
#/ip firewall nat add chain=srcnat action=masquerade out-interface=ether1
#
##RUTAS Gcloud
#Borra la salida x defecto de la red-sin-internet 
#red= red-sin-internet direcciones-destino= 0.0.0.0/0 sig.salto=ip-mikrotik
#red = red-cliente direcciones-destino=red-sin-internet sig.salto=mikrotik
#
#Editar fichero de una vm para que el timeout sea X en /etc/systemd/system/network-online.targets.wants/networking.service
#
##DSTNAT-> Redirigir peticiones del p=80 de mikrotik a la mv interna con apache
#/ip firewall nat add chain=dstnat protocol=tcp dst-port=80 in-interface=ether1 action=dst-nat to-addresses=(ip-privada-que-contiene-la-página-web(mvservidor)) to-ports=80 comment="Port forward HTTP to net2"
#
#Habilitar puerto 80 y 443 tanto en mikrotik como en mv sin internet
#
#LUEGO PARA PONER MIKROTIK EN EL PUERTO 443 SIN CERTIFICADO POR PROTOCOLO HTTP:
#
##/ip service set www port=443
#
##Analizar TCP/UDP
#sudo apt install nmap 
#nmap -sT IP_MV
#nmap -SU IP_MV
#
#Desmilitarizado
#
# 0    ;;; Allow established input
#      chain=input action=accept connection-state=established,related
#
# 1    ;;; Allow management from NET1
#      chain=input action=accept in-interface=ether1
#
# 2    ;;; Allow management from NET2
#      chain=input action=accept in-interface=ether2
#
# 3    ;;; Allow management from NET3
#      chain=input action=accept in-interface=ether3
#
# 4    ;;; Allow established/related connections
#      chain=forward action=accept connection-state=established,related
#
# 5    ;;; net1 -> net2 HTTP only
#      chain=forward action=accept protocol=tcp in-interface=ether1 out-interface=ether2
#      dst-port=80
#
# 6    ;;; net3 -> net2 HTTP only
#      chain=forward action=accept protocol=tcp in-interface=ether3 out-interface=ether2
#      dst-port=80
#
# 7    ;;; BLOCK net2 -> net3 (total isolation)
#      chain=forward action=drop in-interface=ether2 out-interface=ether3
#
# 8    ;;; net3 -> Internet HTTP/HTTPS only
#      chain=forward action=accept protocol=tcp in-interface=ether3 out-interface=ether1
#      dst-port=80,443
#
# 9    ;;; net2 -> Internet full access
#      chain=forward action=accept in-interface=ether2 out-interface=ether1
#
#10    ;;; net1 -> net3 full access
#      chain=forward action=accept in-interface=ether1 out-interface=ether3
#
#11    ;;; DROP all other traffic
#      chain=forward action=drop
#
#PARA CREARLAS:
#
# INPUT CHAIN
#/ip firewall filter add chain=input action=accept connection-state=established,related comment="Allow established input"
#/ip firewall filter add chain=input action=accept in-interface=ether1 comment="Allow management from NET1"
#/ip firewall filter add chain=input action=accept in-interface=ether2 comment="Allow management from NET2"
#/ip firewall filter add chain=input action=accept in-interface=ether3 comment="Allow management from NET3"
#
# FORWARD CHAIN
#/ip firewall filter add chain=forward action=accept connection-state=established,related comment="Allow established/related connections"
#/ip firewall filter add chain=forward action=accept protocol=tcp in-interface=ether1 out-interface=ether2 dst-port=80 comment="net1 -> net2 HTTP only"
#/ip firewall filter add chain=forward action=accept protocol=tcp in-interface=ether3 out-interface=ether2 dst-port=80 comment="net3 -> net2 HTTP only"
#/ip firewall filter add chain=forward action=drop in-interface=ether2 out-interface=ether3 comment="BLOCK net2 -> net3 (total isolation)"
#/ip firewall filter add chain=forward action=accept protocol=tcp in-interface=ether3 out-interface=ether1 dst-port=80,443 comment="net3 -> Internet HTTP/HTTPS only"
#/ip firewall filter add chain=forward action=accept in-interface=ether2 out-interface=ether1 comment="net2 -> Internet full access"
#/ip firewall filter add chain=forward action=accept in-interface=ether1 out-interface=ether3 comment="net1 -> net3 full access"
#/ip firewall filter add chain=forward action=drop comment="DROP all other traffic"
#
#P6
#
#CERTIFICADO
#sudo apt install apache2 -y 
#sudo a2enmod ssl  //Habilita modulo https en apache
#sudo systemctl restart apache2
#sudo systemtcl enable apache2
#sudo mkdir -p /etc/ssl/private //directorio donde guardamos el certificado y la clave
#sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/apache-selfsigned.key -out /etc/ssl/certs/apache-selfsigned.crt
#ES
#Almeria
#Almeria
#UAL
#ARSO
#poner ip externa servidor web
#correoUAL
#sudo cat /etc/ssl/private/apache-selfsigned.key //COPIALO
#sudo cat /etc/ssl/certs/apache-selfsigned.crt //COPIALO
#sudo nano /etc/apache2/sites-available/default-ssl.conf
#CAMBIA ESTO: 
#   SSLCertificateFile      /etc/ssl/certs/apache-selfsigned.crt
#   SSLCertificateKeyFile /etc/ssl/private/apache-selfsigned.key
#sudo a2ensite default-ssl.conf //Habilita un sitio web (el archivo de configuración de ssl)
#sudo systemctl reload apache2
#sudo apache2ctl configtest //Te debe dar OK
#
##Plantilla
#Disco de arranque -> Imagen: imagen-servidorweb
#E2-micro
#Activamos FIrewall HTTP y HTTPS
#
#Cluster
#Plantilla: plantilla-servidorweb
#Ubicación: zona Única
#Ajuste de Escala automático -> número de instancias (min, max)= 1 y 5
#      Autoscaling signals > Editar Indicador: 
#            Tipo de indicador = Uso de balanceo de cargas de HTTP
#            Uso de balanceo de carga Objetivo = 80
#Ciclo de Vida de la Instancia de VM
#    Reparación Automática > Verificación de Estado > Crear una verificación de estado:
#    Criterios de buen estado
#        Intervalo de verificación: 10
#        Umbral de mal estado: 3
#        Retraso Inicial = 60
#    Dale a crear
#Te va a salir un aviso de "La configuración del ajuste de escala automático no está completa", dale a Confirm.
#
#Entra y asegurate de que todo lo puesto anteriormente está bien.
#Entramos en edición:
#    Asignación de puertos> Agregar puerto:
#        Nombre: https ; puerto: 443
#
#Aunque te salga aviso en rojo de que no hay backend, seguimos con el balanceador.
#        
##Balanceador 
#    1.Balanceador de cargas de aplicaciones (HTTP/HTTPS)
#    2.Orientado al público (externo) 
#    3.Ideal para cargas de trabajo globales 
#    4.Balanceador de cargas de aplicaciones clásico 
#    5. Configurar
#    
#    Ponle nombre al balanceador.
#    Configuración Fronted (HTTP):
#    Primer Frontend:
#        Dirección Ip: reserva una con el nombre de "ip-cluster"
#    Listo
#    Segundo Frontend (HTTPS):
#        Protocolo:HTTPS
#        Dirección IP= ip cluster
#        Certificado > Crear un certificado nuevo:
#            Pega el certificado y la clave que creamos en la MV servidorweb
#        Usar certificado autofirmado
#    
#            
#        
#    Configuración Backend:
#    Servicios y buckets de backend > Crear un servicio de Backend:
#        Protocolo: HTTPS
#        Puerto con nombre: https
#        Verificación de estado: la que hicimos anteriormente
#        Backends > Nuevo Backend:
#            Grupo de Instancias= cluster
#(te va a salir un aviso del puerto, dile que sí. Justo se te debe configurar el puerto 443 que es el que habíamos configurado antes)
#            Listo
#        
#        Deshabilita el "Habilitar Cloud CDN"
#        Cloud Armor = Ninguno
#    Crear (Conf Backend)
#    
#    Crear (Balanceador)
##Prueba
#export LB_IP=[IP_EXTERNA_BALANCEADOR].
#ab -n 50000 -c 1000 http://$LB_IP/ convierte el txt a markdown y dejame a mi hacer el indice y reorganizarlo 
